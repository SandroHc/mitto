# Upload utility block
# https://github.com/SandroHc/mitto
#

server {
	listen      [::]:80;

	server_name i.sandrohc.net;
	return      301 https://$server_name$request_uri;
}

server {
	listen      [::]:8443 ssl http2;

	server_name i.sandrohc.net;

	root /var/www/static;

	include snippets/ssl.conf;
	include snippets/base.conf;

	error_page 404 /var/www/blog/404.html;
	error_page 403 /var/www/blog/403.html;

	# https://nginx.org/en/docs/http/ngx_http_core_module.html#location
	location = /upload {
		client_max_body_size 500M;
		proxy_pass http://mitto;
	}
	location = /purge {
		proxy_pass http://mitto;
	}
	location ^~ /delete/ {
		proxy_pass http://mitto;
	}
	location = /sharex {
		try_files files/sharex.sxcu;
	}
	location / {
		try_files $uri;

		charset utf-8;
		default_type text/plain;

#		autoindex on;
#		autoindex_exact_size off;
	}
}

upstream mitto {
	server localhost:6000;
}
